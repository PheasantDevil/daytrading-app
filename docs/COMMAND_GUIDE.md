# コマンド使用ガイド

このドキュメントでは、すべてのnpmスクリプトコマンドの詳細な使用方法を説明します。

---

## 📋 目次

1. [仮想取引コマンド（初心者向け）](#仮想取引コマンド初心者向け)
2. [本番取引コマンド（上級者向け）](#本番取引コマンド上級者向け)
3. [開発コマンド](#開発コマンド)
4. [テストコマンド](#テストコマンド)
5. [Dockerコマンド](#dockerコマンド)
6. [コマンド選択フローチャート](#コマンド選択フローチャート)

---

## 仮想取引コマンド（初心者向け）

### `npm run practice:start`

**概要:** 基本的な仮想取引システムを開始

**安全性:** ✅ 完全に安全（実資金不使用）

**実行内容:**
- 仮想資金$100,000でスタート
- AAPL, GOOGL, MSFTの株式を自動売買
- リアルタイムで価格変動（±0.5%/秒）
- 損益をリアルタイム計算
- 取引統計を表示

**出力例:**
```
📊 初期口座情報:
残高: $100,000
純資産: $100,000
購買力: $400,000

📈 テスト取引1: AAPL（Apple）100株を成行買い
✅ 約定: 100株 @ $175.50

⏱️ 市場シミュレーション中（5秒間）...

📊 更新されたポジション:
AAPL: 100株
未実現損益: $59.95

📊 最終口座情報:
純資産: $100,059.95
総損益: $59.95 (+0.06%)
```

**所要時間:** 約20秒

**いつ使う:**
- ✅ 初めてシステムを試すとき
- ✅ 仮想取引の基本を学びたいとき
- ✅ システムの動作確認をしたいとき

**注意事項:**
- 実際のお金は一切使用しない
- 何度実行してもリスクなし
- データはリアルタイム市場データではなくシミュレーション

---

### `npm run practice:hybrid`

**概要:** Yahoo Finance + Interactive Brokers ハイブリッドシステムのテスト

**安全性:** ✅ 完全に安全（実資金不使用）

**実行内容:**
- Yahoo Financeで銘柄スクリーニング
- 履歴データ分析（過去30日分）
- 企業情報の取得
- トレンド銘柄の確認
- Interactive Brokersで模擬取引

**出力例:**
```
📊 === Yahoo Finance機能のテスト ===

1. リアルタイム株価取得（Yahoo Finance）
AAPL (Apple): 価格: $192.79, 変動: -0.41%

2. 複数銘柄の株価取得
AAPL: $192.79 (-0.41%)
GOOGL: $179.09 (-1.27%)
MSFT: $160.97 (-2.39%)
TSLA: $166.81 (+0.49%)

3. 履歴データの取得
AAPL の過去30日分のデータ: 30件

6. 企業情報の取得
名前: Apple Inc.
セクター: Technology
業種: Consumer Electronics
従業員数: 161,000

🔷 === Interactive Brokers機能のテスト ===

9. アカウント情報の取得
口座番号: DU1234567
残高: $100,000
```

**所要時間:** 約30秒

**いつ使う:**
- ✅ ハイブリッドシステムを理解したいとき
- ✅ Yahoo Finance APIの機能を試したいとき
- ✅ データソースの切り替えを体験したいとき

**注意事項:**
- Yahoo Finance APIは簡易実装（モックデータ）
- 実際の市場データではなくシミュレーション
- 実際のお金は一切使用しない

---

## 本番取引コマンド（上級者向け）

### ⚠️ 重要: 本番コマンドは慎重に実行してください

---

### `npm run production:setup`

**概要:** Interactive Brokers接続の初回設定

**安全性:** ⚠️ 中（設定のみ、取引はしない）

**実行内容:**
- Interactive Brokers統合サービスのセットアップ
- 接続情報の設定
- 設定ファイルの作成

**前提条件:**
1. Interactive Brokers口座開設済み
2. TWS/IB Gatewayインストール済み
3. `.env.local` に必要な情報を設定済み

**必要な環境変数:**
```bash
IB_HOST=127.0.0.1
IB_PORT=7497  # 7497=ペーパートレーディング, 7496=本番取引
IB_CLIENT_ID=1
IB_ACCOUNT_ID=your_account_id
IB_PAPER_TRADING=true  # ペーパートレーディングの場合true
```

**いつ使う:**
- ✅ Interactive Brokers口座を開設した直後
- ✅ 接続設定を変更したとき
- ✅ 新しい環境で初めて実行するとき

**注意事項:**
- 初回のみ実行
- 環境変数が正しく設定されているか確認
- ペーパートレーディングから開始推奨

---

### `npm run production:test`

**概要:** Interactive Brokers接続テスト

**安全性:** ⚠️ 中（接続確認のみ、取引はしない）

**実行内容:**
- IB APIへの接続確認
- アカウント情報の取得
- ポジション情報の確認
- 市場データ取得のテスト

**出力例:**
```
✅ Interactive Brokers接続テスト開始
✅ 接続成功

📊 アカウント情報:
口座番号: DU1234567
残高: $100,000
証拠金可能額: $100,000

✅ 全ての接続テストが完了しました
```

**所要時間:** 約10秒

**いつ使う:**
- ✅ 接続設定後の確認
- ✅ 定期的な接続確認
- ✅ 本番取引開始前の最終確認

**注意事項:**
- TWS/IB Gatewayが起動している必要がある
- 市場データのサブスクリプションが必要（本番時）

---

### `npm run production:deploy`

**概要:** 本番環境へのデプロイ（Gitワークフロー）

**安全性:** 🔴 高リスク（本番環境への変更）

**実行内容:**
- 新しいブランチの作成
- コミットとプッシュ
- プルリクエストの作成
- メインブランチへのマージ

**いつ使う:**
- 🔴 本番環境にコードをデプロイするとき
- 🔴 新機能を本番リリースするとき

**⚠️ 警告:**
- **このコマンドは管理者のみが使用すべきです**
- 本番環境に影響を与えます
- 十分なテストを行ってから実行してください
- 初心者は実行しないでください

---

## 開発コマンド

### `npm run dev`

**概要:** 開発サーバーの起動

**実行内容:**
- Next.js開発サーバーを起動
- http://localhost:3000 でアクセス可能
- ホットリロード有効

**いつ使う:**
- フロントエンド開発時
- UIのテスト時

---

### `npm run build`

**概要:** 本番用ビルド

**実行内容:**
- TypeScriptのコンパイル
- Next.jsの最適化ビルド
- 静的アセットの生成

**いつ使う:**
- デプロイ前
- 本番環境の準備時

---

### `npm run lint`

**概要:** コードの品質チェック

**実行内容:**
- ESLintによるコードチェック
- コーディング規約の確認

**いつ使う:**
- コミット前
- コードレビュー前

---

### `npm run format`

**概要:** コードの自動整形

**実行内容:**
- Prettierによるコード整形
- インデント、改行の統一

**いつ使う:**
- コード作成後
- コミット前

---

## テストコマンド

### `npm run test:trading`

**概要:** 自動売買機能のテスト

**実行内容:**
- 自動売買サービスのテスト
- トレーディングスケジューラーのテスト
- ブローカー統合のテスト

**いつ使う:**
- 自動売買機能の確認時
- 新機能追加後

---

### `npm run test:phases`

**概要:** 全フェーズ（Phase1-7）の機能テスト

**実行内容:**
- Phase1からPhase7までの全機能をテスト
- 各フェーズの統合テスト

**所要時間:** 約5分

**いつ使う:**
- 大規模な変更後
- リリース前の最終確認

---

### `npm run test:phase1` ~ `npm run test:phase7`

**概要:** 個別フェーズのテスト

**各フェーズの内容:**
- **Phase1**: コア機能（リスク管理、バックテスト、テクニカル分析）
- **Phase2**: データ統合（複数API、デモ取引）
- **Phase3**: リアル取引統合
- **Phase4**: クラウド統合（AWS）、スケーラビリティ
- **Phase5**: AI/ML統合、リアルタイム処理
- **Phase6**: エッジコンピューティング、次世代技術
- **Phase7**: 全機能統合

**いつ使う:**
- 特定機能の確認時
- 段階的な動作確認時

---

## Dockerコマンド

### `npm run docker:dev`

**概要:** 開発用Dockerコンテナの起動

**実行内容:**
- PostgreSQL起動
- Redis起動
- 開発用環境の構築

---

### `npm run docker:build`

**概要:** Dockerイメージのビルド

---

### `npm run docker:up`

**概要:** Dockerコンテナの起動

---

### `npm run docker:down`

**概要:** Dockerコンテナの停止

---

## コマンド選択フローチャート

```
開始
 ↓
初めて使う？
 ├─ YES → npm run practice:start
 │         ↓
 │      ハイブリッドも試す？
 │         ├─ YES → npm run practice:hybrid
 │         └─ NO → 終了
 │
 └─ NO → 開発？
          ├─ YES → 開発コマンド
          │         ├─ npm run dev
          │         ├─ npm run lint
          │         └─ npm run format
          │
          └─ NO → 本番準備？
                   ├─ YES → 段階的に実行
                   │         ├─ 1. npm run production:setup
                   │         ├─ 2. npm run production:test
                   │         └─ 3. 十分なテスト後に production:deploy
                   │
                   └─ NO → テスト実行
                            ├─ npm run test:trading
                            └─ npm run test:phases
```

---

## コマンド実行チェックリスト

### 初心者向けチェックリスト

- [ ] `npm install` を実行済み
- [ ] `npm run practice:start` で仮想取引を試した
- [ ] `npm run practice:hybrid` でハイブリッドシステムを理解した
- [ ] ドキュメントを読んだ
- [ ] 取引の仕組みを理解した

### 本番移行チェックリスト

- [ ] Interactive Brokers口座を開設済み
- [ ] ペーパートレーディングアカウントを取得済み
- [ ] TWS/IB Gatewayをインストール済み
- [ ] `.env.local` に必要な情報を設定済み
- [ ] `npm run production:setup` を実行済み
- [ ] `npm run production:test` で接続確認済み
- [ ] ペーパートレーディングで十分にテスト済み
- [ ] リスク管理を理解している
- [ ] 損失のリスクを理解している

---

## トラブルシューティング

### コマンドが失敗する場合

1. **`npm install` を実行したか確認**
   ```bash
   npm install
   ```

2. **Node.jsのバージョンを確認**
   ```bash
   node --version  # v18以上が必要
   ```

3. **環境変数を確認**
   ```bash
   # .env.local ファイルが存在するか
   ls .env.local
   ```

4. **Dockerが起動しているか確認**（Dockerコマンド使用時）
   ```bash
   docker ps
   ```

### よくあるエラー

**エラー: "Module not found"**
```bash
# 解決策
npm install
```

**エラー: "Interactive Brokersに接続できない"**
```bash
# 確認事項:
# 1. TWS/IB Gatewayが起動しているか
# 2. .env.local の設定が正しいか
# 3. ポート番号が正しいか（7497 or 7496）
```

**エラー: "Permission denied"**
```bash
# 解決策
sudo chmod +x ./scripts/*.ts
```

---

## まとめ

### 推奨されるコマンド実行順序

**初心者:**
1. `npm install`
2. `npm run practice:start`
3. `npm run practice:hybrid`

**開発者:**
1. `npm install`
2. `npm run dev`
3. `npm run lint`
4. `npm run test:phases`

**本番移行:**
1. `npm run production:setup`
2. `npm run production:test`
3. 十分なテスト後... `npm run production:deploy`

---

**困ったときは README.md の「よくある質問」セクションを参照してください！**
