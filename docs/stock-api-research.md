# 株価API調査・選定

## 調査対象API

### 1. Alpha Vantage API

- **URL**: https://www.alphavantage.co/
- **料金**: 無料プラン（月500回）、有料プラン（月$49.99〜）
- **対応市場**: 米国、日本、欧州、アジア
- **データ種類**: リアルタイム、履歴、技術指標
- **制限**: 無料プランは1分間に5回まで
- **メリット**: 豊富なデータ、日本株対応
- **デメリット**: 無料プランは制限が厳しい

### 2. Yahoo Finance API (非公式)

- **URL**: https://query1.finance.yahoo.com/
- **料金**: 無料
- **対応市場**: 全世界
- **データ種類**: リアルタイム、履歴
- **制限**: レート制限あり
- **メリット**: 完全無料、豊富なデータ
- **デメリット**: 非公式、突然変更される可能性

### 3. IEX Cloud

- **URL**: https://iexcloud.io/
- **料金**: 無料プラン（月500,000回）、有料プラン（月$9〜）
- **対応市場**: 米国中心
- **データ種類**: リアルタイム、履歴、ニュース
- **制限**: 無料プランは1秒間に100回まで
- **メリット**: 高品質なデータ、豊富な機能
- **デメリット**: 日本株の対応が限定的

### 4. Polygon.io

- **URL**: https://polygon.io/
- **料金**: 無料プラン（月5回）、有料プラン（月$99〜）
- **対応市場**: 米国、カナダ
- **データ種類**: リアルタイム、履歴、オプション
- **制限**: 無料プランは制限が厳しい
- **メリット**: 高頻度データ、リアルタイム
- **デメリット**: 高価格、日本株非対応

### 5. 日本株専用API

#### 5.1 KabuステーションAPI（三菱UFJ eスマート証券）

- **URL**: https://kabucom.github.io/kabusapi/ptal/
- **料金**: 無料（口座開設必要）
- **対応市場**: 日本（現物株、信用取引、先物・オプション、投資信託、FX、プチ株®）
- **データ種類**: リアルタイム、注文、約定履歴
- **制限**: 口座開設が必要
- **メリット**: 公式API、高速取引（RAIDEN®基盤）、多言語対応
- **デメリット**: 口座開設が必要

##### KabuステーションAPI詳細情報

**必要な認証情報**:

- **APIパスワード**: kabuステーション®で設定したAPIパスワード
- **ユーザーID**: 三菱UFJ eスマート証券のログインID
- **パスワード**: ログインパスワード

**セキュリティ要件**:

- **kabuステーション®起動**: API利用時はkabuステーション®の起動が必要
- **APIパスワード設定**: 6桁以上16桁以下の英数字

**取得手順**:

1. 三菱UFJ eスマート証券で口座開設
2. kabuステーション®をダウンロード・インストール
3. 「設定・申込」→「らくらく電子契約」→「kabu.com API利用契約」
4. APIパスワード設定（英数字6桁以上16桁以下）
5. kabuステーション®再起動

**API機能**:

- リアルタイム株価取得
- 注文発注・取消
- 口座残高・ポジション確認
- 約定履歴取得
- 高速取引（RAIDEN®基盤）

#### 5.2 SBI証券API

- **URL**: https://site2.sbisec.co.jp/
- **料金**: 無料（口座開設必要）
- **対応市場**: 日本
- **データ種類**: リアルタイム、注文、口座情報
- **制限**: 口座開設が必要
- **メリット**: 公式API、リアルタイム取引
- **デメリット**: 口座開設が必要

##### SBI証券API詳細情報

**必要な認証情報**:

- **APIキー**: SBI証券開発者ポータルで取得
- **シークレットキー**: APIキーと対になる秘密鍵
- **ユーザーID**: SBI証券のログインID
- **パスワード**: SBI証券のログインパスワード
- **取引パスワード**: 取引実行時に必要なパスワード
- **口座番号**: SBI証券の取引口座番号

**セキュリティ要件**:

- **デバイス認証**: API利用端末の事前登録が必要
- **FIDO認証**: スマホ認証の設定推奨
- **二要素認証**: セキュリティ強化のため推奨

**取得手順**:

1. SBI証券ウェブサイトにログイン
2. 「口座管理」→「お客さま情報 設定・変更」→「各種サービス」
3. API利用申請・設定
4. デバイス認証の設定
5. APIキー・シークレットキーの取得

**API機能**:

- リアルタイム株価取得
- 注文発注・取消
- 口座残高・ポジション確認
- 約定履歴取得
- 損益計算

## 推奨アプローチ

### 開発フェーズ

1. **Yahoo Finance API (非公式)**: 無料で豊富なデータ
2. **Alpha Vantage API**: 公式API、日本株対応

### 本番フェーズ

1. **kabuステーションAPI**: 口座開設後（推奨）
2. **SBI証券API**: 口座開設後（代替案）
3. **Alpha Vantage API**: 有料プラン（補完用）

## 実装方針

### 1. マルチAPI対応

- 複数のAPIを組み合わせて冗長性を確保
- プライマリAPIとフォールバックAPIを設定

### 2. データキャッシュ

- Redisを使用してデータをキャッシュ
- API制限を回避

### 3. エラーハンドリング

- API障害時の自動切り替え
- データ取得失敗時の再試行

### 4. レート制限対応

- リクエスト間隔の制御
- バッチ処理の実装

## 実装予定

### Phase 2.1: 基本データ取得

- Yahoo Finance API実装
- 基本的な株価データ取得

### Phase 2.2: リアルタイム対応

- WebSocket実装
- リアルタイムデータ取得

### Phase 2.3: マルチAPI対応

- Alpha Vantage API追加
- フォールバック機能実装

### Phase 2.4: 最適化

- キャッシュ機能実装
- レート制限対応

### Phase 4.1: SBI証券API統合

- 証券口座情報管理機能
- SBI証券API認証システム
- リアルタイム取引機能

### Phase 4.2: 取引機能実装

- 注文発注・取消機能
- ポジション管理
- リスク管理機能
